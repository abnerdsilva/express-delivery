USE expressDelivery;


--DROP TABLE TB_USUARIO;
CREATE TABLE TB_USUARIO (
	ID_USER INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	USUARIO VARCHAR(50) NOT NULL,
	SENHA VARCHAR(20) NOT NULL,
	TIPO_USUARIO VARCHAR(20) NOT NULL,
	STATUS_USUARIO BIT NOT NULL DEFAULT 1,
	DATA_CRIACAO DATETIME NOT NULL DEFAULT GETDATE(),
);

insert into TB_USUARIO (usuario, senha, tipo_usuario) values ('admin', '123', 'ADMIN');

SELECT * FROM TB_USUARIO;
SELECT * FROM TB_USUARIO WHERE USUARIO = 'admin' AND SENHA = '123' AND STATUS_USUARIO=1;


--DROP TABLE TB_CLIENTE;
CREATE TABLE TB_CLIENTE (
	COD_CLIENTE INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	NOME VARCHAR(50) NOT NULL,
	TELEFONE VARCHAR(15) NOT NULL UNIQUE,
	EMAIL VARCHAR(100),
	CPF VARCHAR(15),
	RG VARCHAR(15),
	LOGRADOURO VARCHAR(150) NOT NULL,
	NUMERO INT NOT NULL,
	BAIRRO VARCHAR(150) NOT NULL,
	CIDADE VARCHAR(50) NOT NULL,
	ESTADO VARCHAR(2) NOT NULL,
	CEP INT NOT NULL,
	STATUS_CLIENTE BIT NOT NULL DEFAULT 1,
	DATA_CADASTRO DATETIME DEFAULT GETDATE(),
	DATA_ATUALIZACAO DATETIME,
	OBSERVACAO VARCHAR(200)
);

SELECT * FROM TB_CLIENTE;

--DROP TABLE TB_PRODUTO;
CREATE TABLE TB_PRODUTO (
	COD_PRODUTO INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	COD_BARRAS VARCHAR(20) NOT NULL UNIQUE,
	NOME VARCHAR(100) NOT NULL,
	CATEGORIA VARCHAR(20) NOT NULL,
	UN_MEDIDA VARCHAR(2) NOT NULL,
	VR_COMPRA DECIMAL(10,2) DEFAULT 0.00,
	VR_UNITARIO DECIMAL(10,2) DEFAULT 0.00,
	MARGEM_LUCRO DECIMAL(10,2) DEFAULT 0.00,
	LOCALIZACAO VARCHAR(50),
	STATUS_PRODUTO BIT NOT NULL DEFAULT 1,
	DATA_CADASTRO DATETIME DEFAULT GETDATE(),
	DATA_ATUALIZACAO DATETIME,
	OBSERVACAO VARCHAR(200)
);

/*
INSERT INTO TB_PRODUTO (NOME, CATEGORIA, VR_UNITARIO) VALUES ('Coxinha de frango', 'SALGADOS', 3.5);
INSERT INTO TB_PRODUTO (NOME, CATEGORIA, VR_UNITARIO) VALUES ('Empada de queijo', 'SALGADOS', 4.05);
INSERT INTO TB_PRODUTO (NOME, CATEGORIA, VR_UNITARIO) VALUES ('Água s/gas 600ml', 'SALGADOS', 4.89);
*/

SELECT * FROM TB_PRODUTO;


--DROP TABLE TB_DELIVERY_BAIRRO;
CREATE TABLE TB_DELIVERY_BAIRRO (
	ID_BAIRRO INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	NOME VARCHAR(150) NOT NULL,
	VR_TAXA DECIMAL(10,2) NOT NULL,
	STATUS_BAIRRO BIT NOT NULL DEFAULT 1,
	DATA_CRIACAO DATETIME NOT NULL DEFAULT GETDATE(),
);


--DROP TABLE TB_PEDIDO;
CREATE TABLE TB_PEDIDO (
	COD_PEDIDO INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	COD_CLIENTE INT NOT NULL,
	STATUS_PEDIDO VARCHAR(10) NOT NULL DEFAULT 'ABERTO',
	DATA_PEDIDO DATETIME NOT NULL DEFAULT GETDATE(),
	DATA_ENTREGA DATETIME,
	VR_TOTAL DECIMAL(10,2) DEFAULT 0.00,
	VR_TAXA DECIMAL(10,2) DEFAULT 0.00,
	VR_TROCO DECIMAL(10,2) DEFAULT 0.00,
	LOGRADOURO VARCHAR(150) NOT NULL,
	NUMERO INT NOT NULL,
	BAIRRO VARCHAR(150) NOT NULL,
	CIDADE VARCHAR(50) NOT NULL,
	ESTADO VARCHAR(2) NOT NULL,
	CEP VARCHAR(10) NOT NULL,
	TIPO_PEDIDO VARCHAR(10) DEFAULT 'ENTREGA',
	ORIGEM VARCHAR(20) DEFAULT 'LOCAL',
	OBSERVACAO VARCHAR(100),
	DATA_ATUALIZACAO DATETIME,
	FORMA_PAGAMENTO VARCHAR(20) NOT NULL,
	COD_PEDIDO_INTEGRACAO VARCHAR(50),
	IMPRIME_PEDIDO int default 0 not null
);

ALTER TABLE TB_PEDIDO
	ADD CONSTRAINT FK_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES TB_CLIENTE(COD_CLIENTE);

/*
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP) VALUES (2, 15.9, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000');
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, VR_TAXA, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP, OBSERVACAO) VALUES (1, 15.9, 8.0, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000', 'Levar maquina de cartão');
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, VR_TAXA, VR_DESCONTO, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP) VALUES (1, 15.9, 7.50, 1.59, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000');
*/

SELECT * FROM TB_PEDIDO;

--DROP TABLE TB_PEDIDO_ITEM;
CREATE TABLE TB_PEDIDO_ITEM (
	COD_PEDIDO_ITEM INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	COD_PEDIDO INT NOT NULL,
	COD_PRODUTO INT NOT NULL,
	QUANTIDADE INT NOT NULL,
	VR_UNITARIO DECIMAL(10,2) NOT NULL DEFAULT 0.00,
	VR_TOTAL DECIMAL(10,2) NOT NULL DEFAULT 0.00,
	OBSERVACAO VARCHAR(100),
);

ALTER TABLE TB_PEDIDO_ITEM
	ADD CONSTRAINT FK_PRODUTO FOREIGN KEY (COD_PRODUTO) REFERENCES TB_PRODUTO(COD_PRODUTO);

ALTER TABLE TB_PEDIDO_ITEM
	ADD CONSTRAINT FK_PEDIDO FOREIGN KEY (COD_PEDIDO) REFERENCES TB_PEDIDO(COD_PEDIDO);

--INSERT INTO TB_PEDIDO_ITEM (COD_PEDIDO, COD_PRODUTO, QUANTIDADE, VR_UNITARIO, VR_TOTAL) VALUES (9, 2, 3, 4.89, 14.67);
--INSERT INTO TB_PEDIDO_ITEM (COD_PEDIDO, COD_PRODUTO, QUANTIDADE, VR_UNITARIO, VR_TOTAL, OBSERVACAO) VALUES (9, 2, 3, 4.89, 14.67, 'ADD GELO');

SELECT * FROM TB_PEDIDO_ITEM;


DROP TABLE TB_CONFIGURACAO
CREATE TABLE TB_CONFIGURACAO (
	COD_CONFIGURACAO INT PRIMARY KEY IDENTITY,
	ITEM VARCHAR(50) NOT NULL,
	FLAG1 TEXT,
	FLAG2 TEXT,
	FLAG3 TEXT,
	FLAG4 TEXT,
	FLAG5 TEXT,
);

insert into TB_CONFIGURACAO (ITEM, FLAG1) values ('INTEGRA_IFOOD', 'SIM');
insert into TB_CONFIGURACAO (ITEM, FLAG1) values ('INTEGRA_IFOOD_TOKEN', '');
insert into TB_CONFIGURACAO (ITEM, FLAG1, FLAG2) values ('MODULO_IMPRESSAO', 'SIM', 'PRINTCOM3');

SELECT * FROM TB_CONFIGURACAO;

create table TB_PEDIDO_INTEGRACAO
(
	id_pedido_integracao int identity
		constraint TB_PEDIDO_INTEGRACAO_pk
			primary key,
	id_integracao varchar(50) not null unique,
	cod_pedido_integracao varchar(50) not null,
	data_criacao datetime not null,
	status_integracao varchar(20) not null,
	codigo_status_integracao varchar(10) not null,
	nr_pedido int default 0 not null
)

select * from TB_PEDIDO_INTEGRACAO;