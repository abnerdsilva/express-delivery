# CREATE
#     DATABASE if not exists expressDelivery;

USE
    expressDelivery;

DROP TABLE IF EXISTS TB_PEDIDO_INTEGRACAO;
DROP TABLE IF EXISTS TB_PEDIDO_ITEM;
DROP TABLE IF EXISTS TB_PEDIDO;
DROP TABLE IF EXISTS TB_USUARIO;
DROP TABLE IF EXISTS TB_CLIENTE;
DROP TABLE IF EXISTS TB_PRODUTO;
DROP TABLE IF EXISTS TB_DELIVERY_BAIRRO;
DROP TABLE IF EXISTS TB_CONFIGURACAO;

-- SELECT UUID();
-- select @@version;

CREATE TABLE TB_USUARIO
(
    ID_USER        VARCHAR(36) NOT NULL,
    USUARIO        VARCHAR(50) NOT NULL,
    SENHA          VARCHAR(80) NOT NULL,
    TIPO_USUARIO   VARCHAR(20) NOT NULL,
    STATUS_USUARIO BIT         NOT NULL DEFAULT 1,
    DATA_CRIACAO   DATETIME    NOT NULL DEFAULT current_timestamp,
    PRIMARY KEY (ID_USER)
);

insert into TB_USUARIO (ID_USER, usuario, senha, tipo_usuario)
values (uuid(), 'admin', '$2a$10$PuD/X99cttb.dDfF0pNSOuw5Nc61FltZ5WAdFASfjmj4hGe6zOqCa', 'ADMIN');


CREATE TABLE TB_CLIENTE
(
    ID               BIGINT PRIMARY KEY AUTO_INCREMENT,
    COD_CLIENTE      varchar(36)  NOT NULL,
    NOME             VARCHAR(50)  NOT NULL,
    TELEFONE         VARCHAR(15)  NOT NULL UNIQUE,
    EMAIL            VARCHAR(100),
    CPF              VARCHAR(15),
    RG               VARCHAR(15),
    LOGRADOURO       VARCHAR(150) NOT NULL,
    NUMERO           INT          NOT NULL,
    BAIRRO           VARCHAR(150) NOT NULL,
    CIDADE           VARCHAR(50)  NOT NULL,
    ESTADO           VARCHAR(2)   NOT NULL,
    CEP              INT          NOT NULL,
    STATUS_CLIENTE   BIT          NOT NULL DEFAULT 1,
    DATA_CADASTRO    DATETIME              DEFAULT current_timestamp,
    DATA_ATUALIZACAO DATETIME,
    OBSERVACAO       VARCHAR(200)
);


CREATE TABLE TB_PRODUTO
(
    ID               BIGINT PRIMARY KEY AUTO_INCREMENT,
    COD_PRODUTO      varchar(36)  NOT NULL,
    COD_BARRAS       VARCHAR(20)  NOT NULL UNIQUE,
    NOME             VARCHAR(100) NOT NULL,
    CATEGORIA        VARCHAR(20)  NOT NULL,
    UN_MEDIDA        VARCHAR(2)   NOT NULL,
    VR_COMPRA        DECIMAL(10, 2)        DEFAULT 0.00,
    VR_UNITARIO      DECIMAL(10, 2)        DEFAULT 0.00,
    MARGEM_LUCRO     DECIMAL(10, 2)        DEFAULT 0.00,
    LOCALIZACAO      VARCHAR(50),
    STATUS_PRODUTO   BIT          NOT NULL DEFAULT 1,
    DATA_CADASTRO    DATETIME              DEFAULT current_timestamp,
    DATA_ATUALIZACAO DATETIME,
    OBSERVACAO       VARCHAR(200)
);


INSERT INTO TB_PRODUTO (COD_PRODUTO, COD_BARRAS, UN_MEDIDA, NOME, CATEGORIA, VR_UNITARIO)
VALUES (uuid(), '123', 'UN', 'PRODUTO PADRAO', 'GERAL', 5.0);
INSERT INTO TB_PRODUTO (COD_PRODUTO, COD_BARRAS, UN_MEDIDA, NOME, CATEGORIA, VR_UNITARIO)
VALUES (uuid(), '124', 'UN', 'PRODUTO PADRAO 2', 'GERAL', 5.0);

CREATE TABLE TB_DELIVERY_BAIRRO
(
    ID_BAIRRO     varchar(36)    NOT NULL,
    NOME          VARCHAR(150)   NOT NULL,
    VR_TAXA       DECIMAL(10, 2) NOT NULL,
    STATUS_BAIRRO BIT            NOT NULL DEFAULT 1,
    DATA_CRIACAO  DATETIME       NOT NULL DEFAULT current_timestamp,
    PRIMARY KEY (ID_BAIRRO)
);


CREATE TABLE TB_PEDIDO
(
    ID                    BIGINT PRIMARY KEY AUTO_INCREMENT,
    COD_PEDIDO            varchar(36)  NOT NULL,
    COD_CLIENTE           varchar(36)  NOT NULL REFERENCES TB_CLIENTE (COD_CLIENTE),
    STATUS_PEDIDO         VARCHAR(10)  NOT NULL DEFAULT 'ABERTO',
    DATA_PEDIDO           DATETIME     NOT NULL DEFAULT current_timestamp,
    DATA_ENTREGA          DATETIME,
    VR_TOTAL              DECIMAL(10, 2)        DEFAULT 0.00,
    VR_TAXA               DECIMAL(10, 2)        DEFAULT 0.00,
    VR_TROCO              DECIMAL(10, 2)        DEFAULT 0.00,
    LOGRADOURO            VARCHAR(150) NOT NULL,
    NUMERO                INT          NOT NULL,
    BAIRRO                VARCHAR(150) NOT NULL,
    CIDADE                VARCHAR(50)  NOT NULL,
    ESTADO                VARCHAR(2)   NOT NULL,
    CEP                   VARCHAR(10)  NOT NULL,
    TIPO_PEDIDO           VARCHAR(10)           DEFAULT 'ENTREGA',
    ORIGEM                VARCHAR(20)           DEFAULT 'LOCAL',
    OBSERVACAO            VARCHAR(100),
    DATA_ATUALIZACAO      DATETIME,
    FORMA_PAGAMENTO       VARCHAR(20)  NOT NULL,
    COD_PEDIDO_INTEGRACAO VARCHAR(50),
    IMPRIME_PEDIDO        int          not null default 0,
    COD_USUARIO           varchar(36)  NOT NULL REFERENCES TB_USUARIO (ID_USER)
);


-- ALTER TABLE TB_PEDIDO
--     ADD CONSTRAINT FK_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES TB_CLIENTE (COD_CLIENTE);

/*
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP) VALUES (2, 15.9, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000');
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, VR_TAXA, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP, OBSERVACAO) VALUES (1, 15.9, 8.0, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000', 'Levar maquina de cart√£o');
INSERT INTO TB_PEDIDO (COD_CLIENTE, VR_TOTAL, VR_TAXA, VR_DESCONTO, LOGRADOURO, NUMERO, BAIRRO, CIDADE, ESTADO, CEP) VALUES (1, 15.9, 7.50, 1.59, 'Rua Xpto', 150, 'Jardim Europa', 'Indaiatuba', 'SP', '13330000');
*/

CREATE TABLE TB_PEDIDO_ITEM
(
    COD_PEDIDO_ITEM varchar(36)    NOT NULL,
    COD_PEDIDO      varchar(36)    NOT NULL REFERENCES TB_PEDIDO (COD_PEDIDO),
    COD_PRODUTO     varchar(36)    NOT NULL REFERENCES TB_PRODUTO (COD_PRODUTO),
    QUANTIDADE      INT            NOT NULL,
    VR_UNITARIO     DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    VR_TOTAL        DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    OBSERVACAO      VARCHAR(100),
    PRIMARY KEY (COD_PEDIDO_ITEM)

);

-- ALTER TABLE TB_PEDIDO_ITEM
--     ADD CONSTRAINT FK_PRODUTO FOREIGN KEY (COD_PRODUTO) REFERENCES TB_PRODUTO (COD_PRODUTO);

-- ALTER TABLE TB_PEDIDO_ITEM
--      ADD CONSTRAINT FK_PEDIDO FOREIGN KEY (COD_PEDIDO) REFERENCES TB_PEDIDO (COD_PEDIDO);

-- INSERT INTO TB_PEDIDO_ITEM (COD_PEDIDO, COD_PRODUTO, QUANTIDADE, VR_UNITARIO, VR_TOTAL) VALUES (9, 2, 3, 4.89, 14.67);
-- INSERT INTO TB_PEDIDO_ITEM (COD_PEDIDO, COD_PRODUTO, QUANTIDADE, VR_UNITARIO, VR_TOTAL, OBSERVACAO) VALUES (9, 2, 3, 4.89, 14.67, 'ADD GELO');

CREATE TABLE TB_CONFIGURACAO
(
    COD_CONFIGURACAO VARCHAR(36) NOT NULL,
    ITEM             VARCHAR(50) NOT NULL,
    FLAG1            TEXT,
    FLAG2            TEXT,
    FLAG3            TEXT,
    FLAG4            TEXT,
    FLAG5            TEXT,
    PRIMARY KEY (COD_CONFIGURACAO)
);

insert into TB_CONFIGURACAO (COD_CONFIGURACAO, ITEM, FLAG1, FLAG2, FLAG3, FLAG4)
values (UUID(), 'INTEGRA_IFOOD', 'NAO', 'KMTV-SGTQ',
        'zfpj3n4b9ux35omat2jdzmsz9fqvnt2e3zdrd7zt2j7ilry5r74podbdp1vz2j9348cr7qq543rmgv66ujm4vn4w0jwln0smtk5',
        '1652411910841');
insert into TB_CONFIGURACAO (COD_CONFIGURACAO, ITEM, FLAG1, FLAG2, FLAG3)
values (UUID(), 'INTEGRA_IFOOD_TOKEN', 'refresh_token',
        'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOiI3YzdlOTU2Zi0xZjg4LTQ0YmEtYWMyZi04YmYzZjIxYmEzNWEiLCJhcHBfbmFtZSI6ImpldGZvb2RwaWNkZWxpdmVyeXRlc3RlZCIsImF1ZCI6WyJzaGlwcGluZyIsImNhdGFsb2ciLCJmaW5hbmNpYWwiLCJyZXZpZXciLCJtZXJjaGFudCIsIm9yZGVyIiwib2F1dGgtc2VydmVyIl0sIm93bmVyX25hbWUiOiJqZXRmb29kcGlkZWxpdmVyIiwic2NvcGUiOlsic2hpcHBpbmciLCJjYXRhbG9nIiwicmV2aWV3IiwibWVyY2hhbnQiLCJvcmRlciIsImNvbmNpbGlhdG9yIl0sImlzcyI6ImlGb29kIiwibWVyY2hhbnRfc2NvcGUiOlsiNTc5NGEzNGQtMTYzZS00MjBhLWFmNjctMmZjOGJkZDg2N2Q3Om1lcmNoYW50IiwiNTc5NGEzNGQtMTYzZS00MjBhLWFmNjctMmZjOGJkZDg2N2Q3Om9yZGVyIiwiNTc5NGEzNGQtMTYzZS00MjBhLWFmNjctMmZjOGJkZDg2N2Q3OmNhdGFsb2ciLCI1Nzk0YTM0ZC0xNjNlLTQyMGEtYWY2Ny0yZmM4YmRkODY3ZDc6Y29uY2lsaWF0b3IiLCI1Nzk0YTM0ZC0xNjNlLTQyMGEtYWY2Ny0yZmM4YmRkODY3ZDc6cmV2aWV3IiwiNTc5NGEzNGQtMTYzZS00MjBhLWFmNjctMmZjOGJkZDg2N2Q3OnNoaXBwaW5nIl0sImV4cCI6MTY1NTA3NjgxMywiaWF0IjoxNjU1MDY2MDEzLCJqdGkiOiI3YzdlOTU2Zi0xZjg4LTQ0YmEtYWMyZi04YmYzZjIxYmEzNWE6N2I2YzQxOWEtOGM5MC00OTdhLWE2NzMtY2MwZmZjMjcxNDJhIiwibWVyY2hhbnRfc2NvcGVkIjp0cnVlLCJjbGllbnRfaWQiOiI3YjZjNDE5YS04YzkwLTQ5N2EtYTY3My1jYzBmZmMyNzE0MmEifQ.GnBEoPxe56PsRZjuzp9KeLWty9TUpq_Ta2zWuRBzipVsVHoYDA2qdRQP3ZgjbtT5FDCCv6BJAqYvBRUnCZtxK3o3vl_HfuI8FWFf4i44AfcDjzL223HeZoWu2N1BjTLuGc7HOj3a6x7l-e7NOGQq-2uNyWK2lMyK14gtFbgly-o',
        'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOiI3YzdlOTU2Zi0xZjg4LTQ0YmEtYWMyZi04YmYzZjIxYmEzNWEiLCJpc3MiOiJpRm9vZCIsImV4cCI6MTY1NTY3MDgxMywiaWF0IjoxNjU1MDY2MDEzLCJjbGllbnRfaWQiOiI3YjZjNDE5YS04YzkwLTQ5N2EtYTY3My1jYzBmZmMyNzE0MmEifQ.SjKPdYg-cyLg83JT2zh2o7ezBxsuwUQbmrP16eWaLk0Hl9SzPQ0getI1bpY7QUc4vpIXsfKob_JBqVhUgcDGHN8lHGyzRKXsebBKaBINyxnXs38WEu_qDUWfHWHtdkr2uQMyx5OJ6R80Z-2n2o-9SvkGwyAG-pUQpR988y8t0eA');
insert into TB_CONFIGURACAO (COD_CONFIGURACAO, ITEM, FLAG1, FLAG2)
values (UUID(), 'MODULO_IMPRESSAO', 'NAO', 'PRINTCOM3');
insert into TB_CONFIGURACAO (COD_CONFIGURACAO, ITEM, FLAG1)
values (UUID(), 'USA_WEBSERVER', 'SIM');

create table TB_PEDIDO_INTEGRACAO
(
    id_pedido_integracao     VARCHAR(36)   NOT NULL,
    id_integracao            varchar(50)   not null unique,
    cod_pedido_integracao    varchar(50)   not null,
    data_criacao             datetime      not null,
    status_integracao        varchar(20)   not null,
    codigo_status_integracao varchar(10)   not null,
    nr_pedido                int default 0 not null,
    PRIMARY KEY (id_pedido_integracao)
);

alter table TB_PEDIDO_INTEGRACAO
    add status_sync_pedido int default 0 null after nr_pedido;


